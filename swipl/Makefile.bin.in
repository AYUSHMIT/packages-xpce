################################################################
# Makefile for preparing/moving/installing the binary distribution of
# SWI-Prolog and/or XPCE
#
# Author: Jan Wielemaker
# E-mail: jan@swi-prolog.org
#
# Targets
#	make		(Re)makes SWI-Prolog startup file and XPCE
#			precompiled Prolog files (QLF-files).  The
#			latter is only possible if you can open a
#			connection to the X-server
#
#	make [prefix=path] [PWD=path-to-here] [PL=pl] [XPCE=xpce] install
#			Install public binaries and manual pages for
#			pl, xpce, chpl and pl-bite.  The binaries are
#			installed in $prefix/bin and the manuals in
#			$prefix/man/man$(mansec)
#
#			The default prefix is /usr/local, the default
#			path-to-here is the result if `pwd`.
#
#			The variables $PL and $XPCE may be used to
#			modify the name of the executable
################################################################


prefix=/usr/local
bindir=$(prefix)/bin
mansec=1
mandir=$(prefix)/man/man$(mansec)

MAKE=@MAKE@
PLNAME=@PLNAME@
PL=bin/@PLARCH@/$(PLNAME)
XPCE=xpce
CLIENT=xpce-client
PLARCH=@PLARCH@
INSTALL_PLARCH=@INSTALL_PLARCH@
EXEEXT=@EXEEXT@

BPL=		bin/$(INSTALL_PLARCH)/$(PLNAME)$(EXEEXT)
PWD=`pwd`

# Make this boot64 for 64-bit processors

STARTUP=	boot32.prc
BOOTPLS=	boot/apply.pl boot/autoload.pl \
		boot/bags.pl boot/dwim.pl \
		boot/history.pl boot/init.pl \
		boot/load.pl boot/parms.pl \
		boot/qlf.pl boot/syspred.pl boot/toplevel.pl \
		boot/topvars.pl boot/writef.pl

all:		$(STARTUP) xpce-qlfs

$(STARTUP):	$(BOOTPLS)
		$(BPL) -f none -O -o $@ -b boot/init.pl

xpce-qlfs:
		@PLBASE=$(PWD); \
		if [ -d xpce ]; then \
		   echo $(MAKE) PL=$$PLBASE/$(BPL); \
                   (cd xpce/prolog/lib; $(MAKE) PL=$$PLBASE/$(BPL)); \
		fi

clean:
		rm -f `find xpce/prolog -name '*.qlf' -print`
